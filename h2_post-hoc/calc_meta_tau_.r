install.packages("rmeta")
library(rmeta)

#a few examples in T cells: vectors of tau* values and their associated SE values

## AUTOIMMUNE DISEASES ##
T_open_AI_tau = c(2.021469026,4.638513999,2.817747204,3.197146363,2.033207298,3.866784167,3.088600276,3.227041077,1.892605415,3.222391367,3.536600984,2.160285723)
T_open_AI_tau_SE = c(0.515621089,0.828893609,0.499064069,0.562822532,0.285028162,0.585675412,0.48633005,0.832728369,0.331718538,0.617833074,0.919291324,0.433594796)

T_dyn_AI_tau = c(2.090306,5.436478014,3.051108656,3.058517686,2.191440744,4.486697982,3.19959261,2.973296585,2.09633188,3.945578592,3.292465843,2.293482242)
T_dyn_AI_tau_SE = c(0.529493782,0.904898007,0.491494951,0.564255861,0.380828763,0.700348841,0.535546635,0.8485645,0.353828587,0.728644526,0.883782292,0.458970467)

T_inv_AI_tau = c(0.102581374,-0.18966514,0.202889906,0.860271952,0.058954918,-0.223961259,0.460831928,0.741264962,-0.03657062,-0.377829968,1.19243589)
T_inv_AI_tau_SE = c(0.477070943,0.809128344,0.426693332,0.457209862,0.338839217,0.406267892,0.379664329,0.680216854,0.346823783,0.593949419,0.933052532)


## cell discrete states tau* ##

#TfhTph
T3 = c(1.26981769,1.9124303,1.04677547,1.21208181,1.1754246,2.1401844,1.48094922,1.8220218,1.00787984,2.76629257,2.39398504,1.2607083)
T3SE = c(0.658015,0.70954515,0.54895091,0.47874987,0.33625872,0.69850862,0.51127919,1.00220895,0.4125744,0.85128425,0.76603273,0.43877522)

#Tph
T7 = c(0.86020893,1.79878507,1.48195455,1.40633244,1.22639306,2.41017224,1.43930334,2.65686768,1.00229104,2.69864752,2.86635657,1.17857959)
T7SE = c(0.43416221,0.76272729,0.52043643,0.46985706,0.34968335,0.75162488,0.46268214,1.1438099,0.30932414,0.80243469,0.90157921,0.42091019)

#Treg, hi
T8 = c(1.0688375,2.0979711,1.82803642,1.16959158,1.23221287,3.15593114,1.40534528,2.87720718,1.12569162,3.04293349,2.94711392,1.33735141)
T8SE = c(0.43354752,0.90738518,0.58761181,0.56619918,0.47285854,1.0112272,0.54079287,1.10991815,0.45372515,1.15144183,0.99188275,0.48024152)

#Treg, lo
T9 = c(1.4681275,2.38883802,1.91983383,1.33294678,1.6019277,2.11987358,1.3403166,1.90144381,1.36833784,3.41346564,1.88653777,1.05569022)
T9SE = c(0.70564294,0.79674578,0.63556113,0.48628967,0.42997781,0.70234894,0.50132436,0.96761003,0.44217259,1.04462114,0.7897596,0.50329931)


##### calculate meta-tau*, meta-tau* SE, and associated pval #####

tau_star=T3
tau_star_SE=T3SE
mm = meta.summaries(tau_star,
                    tau_star_SE,
                    method="random")

mm$summary #(meta-analysed tau-star)
mm$se.summary #(se of meta-analysed tau-star)

pnorm(q = 0, mean = mm$summary, sd = mm$se.summary)